<html>
    <script type="application/javascript">
    function receiveMessage(event) {
        console.log('parent got message!');
        var images = event.data;
        var result = "";
        for (var i = 0; i < images.length; i++) {
            result += '<p>' +images[i].src + '</p>';   
        }
        document.body += '<div>' + result + '</div>';
    }
        
    window.addEventListener("foo", receiveMessage, false);
    window.top.addEventListener("iframe-broadcast-imageslist", receiveMessage, false);
    window.onload = function () {
        window.postMessage("iframe-broadcast-imageslist", "*");
        
        var frames = window.frames;
        for (var i = 0; i < frames.length; i++) {
            frames[i].postMessage("maindoc-broadcast-getimages", "*");
            frames[i].window.postMessage("maindoc-broadcast-getimages", "*");
            frames[i].window.top.postMessage("maindoc-broadcast-getimages", "*");
}
        window.postMessage("maindoc-broadcast-getimages", "*");
    }
  
//function receive(event){
//    var data = event.data;
//    if(typeof(window[data.func]) == "function"){
//        window[data.func].call(null, data.params[0]);
//    }
//}   
    
    </script>
<body>
    Main page<p>
    </p>
    <iframe src="adrepl_iframe.html" width="600" height="400"></iframe>
</body></html>  